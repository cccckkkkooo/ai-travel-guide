# –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π python 3.9 –æ–±—Ä–∞–∑
FROM python:3.9-slim

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º requirements.txt —Å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º –ø—É—Ç–µ–º
COPY requirements.txt /app/requirements.txt

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN pip install --no-cache-dir -r /app/requirements.txt

# –ö–æ–ø–∏—Ä—É–µ–º –≤–µ—Å—å –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
COPY . /app/

# –ï—Å–ª–∏ –ø–∞–ø–∫–∞ public –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - —Å–æ–∑–¥–∞—ë–º –µ—ë –∏ –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ—Å—Ç–æ–π index.html
RUN mkdir -p /app/public && \
    if [ ! -f /app/public/index.html ]; then \
    echo '<html><body><h1>üåç AI Travel Guide API</h1><p>API —Ä–∞–±–æ—Ç–∞–µ—Ç! –ò—Å–ø–æ–ª—å–∑—É–π endpoints:</p><ul><li>/api/health</li><li>/api/search-attractions</li><li>/api/search-restaurants</li></ul></body></html>' > /app/public/index.html; \
    fi

# –£–±–µ–¥–∏–º—Å—è —á—Ç–æ Python –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –º–æ–¥—É–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
ENV PYTHONPATH=/app:/app/server:$PYTHONPATH

# Google Cloud Run –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 8080
EXPOSE 8080

# –ó–∞–ø—É—Å–∫–∞–µ–º Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Gunicorn –∏–∑ –∫–æ—Ä–Ω—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—É—Ç–∏ –∫ –º–æ–¥—É–ª—é
CMD exec gunicorn --bind :8080 --workers 1 --threads 8 --timeout 0 --pythonpath /app/server server.flask_server_v3:app
